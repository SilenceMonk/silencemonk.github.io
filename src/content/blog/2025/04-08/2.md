---
title: '所有结点对最短路径 (APSP) 问题'
description: "这节课主要讲的是所有结点对最短路径 (All-Pairs Shortest Paths - APSP) 问题。"
date: 2025-04-08
tags: ['算法复习']
authors: ['saaaadcat']
---


1. **问题定义**:
    * 给定一个加权有向图 G（可能包含负权边，但通常假设没有负权环）。
    * 目标是计算图中**每一对**顶点 `(u, v)` 之间的最短路径的权重。
    * 输出通常是一个 `n x n` 的矩阵，其中 `n` 是顶点数，矩阵的 `(i, j)` 项表示从顶点 `i` 到顶点 `j` 的最短路径权重。
    * 一个典型的应用是计算地图上城市间的距离表。

2. **基本方法**:
    * 最直接的想法是：对每个顶点 `u` 作为源点，运行一次**单源最短路径 (SSSP)** 算法。
    * 如果**没有负权边**：运行 `|V|` 次 Dijkstra 算法。使用斐波那契堆的复杂度是 O(V * (V log V + E)) = O(V^2 log V + VE)。对于稠密图 (E ≈ V^2)，这接近 O(V^3)。
    * 如果**有负权边**（但无负权环）：运行 `|V|` 次 Bellman-Ford 算法。复杂度是 O(V * VE) = O(V^2 E)。对于稠密图，这高达 O(V^4)，效率较低。

3. **专门的 APSP 算法**: 这节课介绍了三种更专门或优化的算法：

    * **基于矩阵乘法的 "重复平方" (Repeated Squaring) 算法**:
        * **思想**: 类似矩阵乘法，但使用 `(min, +)` 运算代替 `(+, *)`。定义 `d_ij^(m)` 为从 `i` 到 `j` 最多包含 `m` 条边的最短路径权重。通过类似矩阵乘法的 `Extend-SP` 操作和重复平方技术（计算 W, W^2, W^4, ..., W^(n-1)）来求解。
        * **复杂度**: O(V^3 log V)。
        * **特点**: 基于动态规划，利用了最短路径和矩阵运算的相似性。

    * **Floyd-Warshall 算法**:
        * **思想**: 动态规划。定义 `d_ij^(k)` 为从 `i` 到 `j`，所有中间结点都取自集合 `{1, 2, ..., k}` 的最短路径权重。递推关系为：`d_ij^(k) = min(d_ij^(k-1), d_ik^(k-1) + d_kj^(k-1))`。直观上是检查路径是否可以通过结点 `k` 来缩短。
        * **复杂度**: O(V^3)。代码结构非常简洁（三重循环）。
        * **特点**: 非常适合稠密图。可以处理负权边（只要没有负权环）。可以方便地修改来计算前驱矩阵以重构路径。也可以用于计算图的**传递闭包 (Transitive Closure)**。

    * **Johnson's 算法**:
        * **思想**: 通过**重新赋权 (Reweighting)** 将所有边的权重变为非负，然后对每个顶点运行一次 Dijkstra 算法。
        * **步骤**:
            1. 构造新图 G'：增加一个新源点 `s`，并从 `s` 向所有原图顶点 `v` 添加权重为 0 的边。
            2. 在 G' 上运行 Bellman-Ford 算法（从 `s` 出发）计算每个顶点 `v` 的势能 `h(v) = δ(s, v)`。如果检测到负权环，则停止。
            3. 重新赋权：对原图中的每条边 `(u, v)`，新权重 `ŵ(u,v) = w(u,v) + h(u) - h(v)`。可以证明 `ŵ(u,v) ≥ 0` 并且不改变最短路径。
            4. 对每个原图顶点 `u`，以 `u` 为源点，在新权重 `ŵ` 下运行 Dijkstra 算法，计算 `δ̂(u, v)`。
            5. 转换回原权重下的最短路径：`δ(u, v) = δ̂(u, v) + h(v) - h(u)`。
        * **复杂度**: O(V^2 log V + VE)。
        * **特点**: 结合了 Bellman-Ford 和 Dijkstra。对于**稀疏图** (E 远小于 V^2)，通常比 Floyd-Warshall (O(V^3)) 更快。

**总结**: 这节课从基本的重复 SSSP 方法出发，引出了三种更高效或专门的 APSP 算法。Floyd-Warshall 简单且适用于稠密图；Johnson's 算法通过巧妙的重新赋权，利用 Dijkstra 处理带负权边的稀疏图，效率更高；基于矩阵乘法的重复平方提供了另一种思路。选择哪种算法取决于图的密度以及是否存在负权边。
