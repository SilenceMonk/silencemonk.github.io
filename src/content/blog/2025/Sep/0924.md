---
title: '最接近原始高斯泼溅同时支持与光照作用的一个方法'
description: 'Adding the minimum stuff to support relightning for gaussian splattings'
date: 2025-09-24
tags: ['高斯泼溅', '图形学']
authors: ['saaaadcat']
---


高斯泼溅每个高斯元的颜色是关于观察方向 $\omega_o$ 的函数。那么在重光照选择BRDF的时候，是否可以直接将Lambertian模型中的常数反照率 $\rho$ 参数化为关于观察方向 $\omega_o$ 的函数来支持高斯泼溅重光照？

先对比Lambertian：

### 1. BRDF 的根本改变

原始的 Lambertian BRDF 是：
$f_r(\omega_i, \omega_o) = \frac{\rho}{\pi}$
其中 $\rho$ 是一个常数（可以是RGB向量）。

修改后的模型变成了：
$f_r(\omega_i, \omega_o) = \frac{\rho(\omega_o)}{\pi}$
其中 $\rho(\omega_o)$ 是一个由3阶球谐函数定义的函数，输入是观察方向 $\omega_o$。

**这带来了两个根本性的改变：**

1. **从与视角无关到与视角相关 (View-Independent -> View-Dependent)**：
    * 原始模型中，无论你从哪个角度看，表面的基础亮度（反射率）都是一样的。
    * 新模型中，表面的基础亮度会随着你的观察角度 $\omega_o$ 的变化而变化。这不再是纯粹的理想漫反射了。

2. **物理真实性的变化（违反亥姆霍兹互易性）**：
    * 一个物理上准确的BRDF必须满足**亥姆霍兹互易性 (Helmholtz Reciprocity)**，即交换入射和出射方向，函数值不变：$f_r(\omega_i, \omega_o) = f_r(\omega_o, \omega_i)$。
    * 我们来检查新模型：
        * $f_r(\omega_i, \omega_o) = \frac{\rho(\omega_o)}{\pi}$
        * $f_r(\omega_o, \omega_i) = \frac{\rho(\omega_i)}{\pi}$
    * 很明显，除非 $\rho$ 是一个常数，否则 $\rho(\omega_o) \neq \rho(\omega_i)$。因此，这个新模型**违反了互易性**，从严格意义上讲，它不再是一个物理上精确的BRDF。它变成了一个**经验模型 (Empirical Model)** 或 **美术驱动 (Art-directed)** 的模型。

### 2. 从视觉效果层面：模拟新的材质现象

这个模型虽然不完全“物理”，但它能非常高效地模拟一类有趣且重要的视觉现象，这些现象是标准Lambertian模型无法表达的。

**主要能模拟的效果是布料的“绒毛感”或“光泽感”(Sheen/Velvet)。**

想象一下天鹅绒、丝绒、绸缎或者某些地毯。这些材质由无数微小的纤维组成。当光线照射时：

* 当你**正对**布料看时，光线可能被纤维吸收或散射到深处，看起来比较暗。
* 当你从一个**掠射角度 (grazing angle)** 看过去时，你看到的是纤维侧面反射的光，这会让布料的边缘或轮廓看起来更亮，甚至呈现出一种柔和的“光晕”。

你的新模型 $f_r = \rho(\omega_o) / \pi$ 能够完美地模拟这种效果：

* 我们可以设计球谐系数，使得当观察方向 $\omega_o$ 与表面法线 $\mathbf{n}$ 的夹角接近90度时（即掠射角），$\rho(\omega_o)$ 的值变大。
* 这样一来，物体的**边缘轮廓 (silhouette)** 就会显得比正面更亮。这正是 **Sheen (光泽)** 或 **Rim Lighting (边缘光)** 的核心特征。

**使用3阶球谐函数（9个系数）的优势：**

* 它足够表达一些低频的方向性变化，比如一个平滑的、从中心向边缘变化的亮度。
* 它又足够简单，计算成本极低。

除了布料，这种模型也可以用来模拟一些表面覆盖着微小颗粒的材质，比如**灰尘、月球表面、桃子**等，它们在特定角度下会表现出亮度变化。

### 3. 从光照计算层面：依然保持高效

这是这个模型最精妙的地方！我们再来看它在渲染方程中的表现：

$L_o(p, \omega_o) = \int_{\Omega} f_r(p, \omega_i, \omega_o) \cdot L_i(p, \omega_i) \cdot (\mathbf{n} \cdot \omega_i) \,d\omega_i$

代入我们的新模型：
$L_o(p, \omega_o) = \int_{\Omega} \frac{\rho(\omega_o)}{\pi} \cdot L_i(p, \omega_i) \cdot (\mathbf{n} \cdot \omega_i) \,d\omega_i$

关键点来了：被积分的变量是入射光方向 $\omega_i$。而我们的新函数 $\rho(\omega_o)$ **只依赖于出射（观察）方向 $\omega_o$**。对于这个积分而言，$\rho(\omega_o)$ 是一个**常数**！

所以，我们可以把它提到积分外面：
$L_o(p, \omega_o) = \frac{\rho(\omega_o)}{\pi} \int_{\Omega} L_i(p, \omega_i) \cdot (\mathbf{n} \cdot \omega_i) \,d\omega_i$

* 后面那个积分 $\int_{\Omega} L_i \cdot (\mathbf{n} \cdot \omega_i) \,d\omega_i$ 正是我们熟悉的**辐照度 (Irradiance)**。
* 这意味着，我们**仍然可以**使用之前讨论的所有高效技术来预计算环境光照，比如 **Irradiance Maps** 或者用 **球谐函数表示的辐照度**。

**计算流程变成：**

1. **预计算（离线）**：像往常一样，计算并存储场景的辐照度信息（例如，存入一个低分辨率的CubeMap或一组SH系数）。
2. **运行时（在Shader中）**：
    a. 计算标准的Lambertian环境光照结果：`DiffuseIrradiance = texture(IrradianceMap, normal);`
    b. **新增步骤**：根据当前的观察方向 `viewDir` 和法线 `normal`，计算出 $\omega_o$。
    c. **新增步骤**：使用 $\omega_o$ 来评估球谐函数 $\rho(\omega_o)$。这通常是9个SH基函数与9个预设系数的点积，速度飞快。`sheenAlbedo = SHEvaluate(wo, AlbedoSHCoefficients);`
    d. 计算最终颜色：`FinalColor = (sheenAlbedo / PI) * DiffuseIrradiance;`

**结论：这个修改在视觉上增加了丰富的细节，但在计算上几乎没有增加额外的成本！**

> 当然，实际上，这是不准确的，因为大部分场景中的物体并不是Sheen/Velvet。模型本身仍然是diffuse的，而高光仍然会会被烘培到高斯元上，移动光照不会出现高光。但这确实是最接近原始高斯泼溅又能支持与光照作用的一个方法
